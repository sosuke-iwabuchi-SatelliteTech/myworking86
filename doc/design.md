# 設計ドキュメント (Design Document)

## メダル獲得条件の変更について

本プロジェクトでは、ゲームの結果に応じて付与されるメダル（王冠）の獲得条件を以下の通り変更しました。
以前はタイムのみが条件でしたが、**スコアが100点（満点）であること**が必須条件となりました。

### 変更後の条件

| メダル種類 | 条件 |
| :--- | :--- |
| 🥇 金メダル (Gold) | **100点** かつ **タイムが20秒以内** |
| 🥈 銀メダル (Silver) | **100点** かつ **タイムが20秒より遅く、25秒以内** |

※ スコアが100点未満の場合、タイムがどれだけ速くてもメダルは付与されません。

## UI/UXの変更

### リザルト画面 (ResultScreen)

*   **メダル表示**: 条件を満たした場合、画面上部のトロフィー（🏆）アイコンの代わりに、獲得したメダル（🥇または🥈）を表示します。
*   **アニメーション**: メダル獲得の達成感を演出するため、メダル表示時に拡大縮小するアニメーション（`medal-anim`）を適用しています。

### 履歴画面 (HistoryScreen)

*   **メダル表示**: 各プレイ履歴のタイム表示の横に、獲得したメダルを表示します。
*   **条件反映**: リザルト画面と同様のロジックで判定を行い、条件を満たした記録にのみメダルを表示します。

## 実装詳細

### CSSアニメーション (`index.css`)

メダルを目立たせるために以下のキーフレームアニメーションを定義しました。

```css
@keyframes medalPulse {
  0% {
    transform: scale(0.5);
    opacity: 0;
  }
  60% {
    transform: scale(1.2);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}
```

## 問題生成アーキテクチャ (Question Generation Architecture)

コードの保守性と拡張性を高めるため、問題生成ロジックを `QuizScreen.tsx` から切り出し、Strategyパターン（Factoryパターン）を用いてリファクタリングしました。

### 構造

*   **インターフェース**: `QuestionGenerator` (`src/questions/QuestionGenerator.ts`)
    *   `generate(): Question` メソッドを定義。
*   **ファクトリ**: `QuestionFactory` (`src/questions/QuestionFactory.ts`)
    *   ゲームレベル（`GameLevel`）を受け取り、適切な `QuestionGenerator` のインスタンスを返します。
*   **実装クラス** (`src/questions/`):
    *   `Grade1CalcGenerator`: 1年生のたし算・ひき算。
    *   `Grade2KukuGenerator`: 2年生の九九。
    *   `Grade4GeometryGenerator`: 4年生の図形の面積（長方形、三角形、台形）。

### 各レベルの問題生成ロジック概要

1.  **1年生 計算 (Grade 1 Calc)**
    *   **たし算**: `(1-10) + (1-10)`
    *   **ひき算**: `(5-19) - (0-num1)` ※答えが負にならないように調整

2.  **2年生 九九 (Grade 2 Kuku)**
    *   `(1-9) × (1-9)`

3.  **4年生 図形 (Grade 4 Geometry)**
    *   **長方形**: `たて(2-9) × よこ(2-9)`
    *   **三角形**: `ていへん(2-9) × たかさ(2-9) ÷ 2`
        *   ※面積が整数になるように、底辺×高さが偶数になるよう調整。
    *   **台形**: `（じょうてい(2-7) ＋ かてい(upper + 2-6)）× たかさ(2-7) ÷ 2`
        *   ※面積が整数になるように、(上底+下底)×高さが偶数になるよう調整。
