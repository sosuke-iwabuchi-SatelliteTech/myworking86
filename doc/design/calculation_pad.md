# 筆算パッド機能 (Calculation Pad Feature)

暗算が難しい計算問題（例：2桁の掛け算）のために、計算の補助として使用できる筆算パッド機能を実装しました。

## 機能概要

*   **目的**: ユーザーが計算過程をメモするための補助的なツール。利用は任意です。
*   **対象問題**: 問題データに `showCalculationPad: true` フラグが設定されている問題でのみ表示されます。
*   **UI**:
    *   計算式と3行x4列の入力マスが表示されます。
    *   問題の数字は、下の入力マス目の列に揃えて見やすく配置されます。
    *   掛け算の記号「×」は、子供にも分かりやすいようSVG画像で表示されます。
    *   画面下部には、4列に再配置されたテンキーが表示されます。これには数字（0-9）、「もどる」、「次へ」ボタンが含まれます。
*   **操作**:
    *   **数字入力**: ユーザーは入力したいマスをクリックしてアクティブにし、テンキーで数字を入力します。入力後、カーソルは自動的に左のマスに移動します。
    *   **「もどる」**: 最後に入力した1文字を消去し、そのマスをアクティブにします。
    *   **「次へ」**: 数字を入力せず、カーソルだけを次のマスへ移動させます。
*   **状態管理**:
    *   新しい問題が表示されるたびに、パッドの入力内容は自動的にすべてクリアされ、常に新しい状態で計算を始められます。
*   **役割**:
    *   筆算パッドへの入力内容は正誤判定には影響せず、あくまでメモとして機能します。最終的な解答は、従来通り4つの選択肢から選択します。

## 計算パッドの不正解時修正モード

計算パッド（じぶんでやるモード）において、ユーザーが間違えた問題に対して、ただ答えを見るだけでなく、自分で修正して正解へたどり着く体験を提供するための機能です。

*   **発動条件**:
    *   「じぶんでやるモード」で「こたえる」ボタンを押し、答えが不正解だった場合に自動的に移行します。

*   **UIの変更点**:
    *   **タイマー停止**: モード移行と同時にタイマーが停止します。
    *   **不正解マスのハイライト**: ユーザーが入力した答えのうち、正解と異なる部分のマスが赤枠で強調表示されます。
    *   **正解の表示**: 計算パッドの下部に、模範解答が緑色の文字で表示されます。
    *   **ボタンの切り替え**: 「こたえる」ボタンが「次の問題へ」ボタンに切り替わります。

*   **インタラクティブな修正**:
    *   ユーザーは赤枠で示されたマスを自由に入力し直すことができます。
    *   入力された数字が正しくなると、そのマスの赤枠はリアルタイムで消えます。
    *   すべてのマスが正しく修正されると、「次の問題へ」ボタンが活性化（押せる状態に）します。

*   **次の問題への進行**:
    *   ユーザーがすべての間違いを修正し、活性化された「次の問題へ」ボタンを押すことで、次の問題へ進みます。

## 実装

*   **コンポーネント**: `src/components/CalculationPad.tsx`
    *   再利用可能なコンポーネントとして実装。レイアウトはGrid CSSを使用し、レスポンシブに対応しています。
*   **データ連携と状態リセット**: `QuizScreen.tsx`
    *   問題データ（`Question`型）の`showCalculationPad`フラグをチェックし、コンポーネントの表示を制御します。
    *   `Question`オブジェクトの`num1`と`num2`プロパティから計算対象の数値を`CalculationPad`コンポーネントに渡します。
    *   `CalculationPad`コンポーネントにユニークな`key`（問題番号）を渡すことで、問題が切り替わるたびにコンポーネントの状態を自動的にリセットし、入力内容をクリアします。
